# name: Metaphysical Lambda CI/CD

# on:
#   push:
#     branches: [ "main" ]
#     paths:
#       - "lambda/metaphysical/**"
#       - ".github/workflows/deploy_metaphysical.yml"
#   pull_request:
#     paths:
#       - "lambda/metaphysical/**"
#       - ".github/workflows/deploy_metaphysical.yml"

# jobs:
#   # ================= CI =================
#   test:
#     name: Test Metaphysical Lambda
#     runs-on: ubuntu-latest
#     defaults:
#       run:
#         working-directory: lambda/metaphysical

#     steps:
#       - name: Checkout code
#         uses: actions/checkout@v4

#       - name: Set up Python (3.10)
#         uses: actions/setup-python@v5
#         with:
#           python-version: "3.10"

#       - name: Install dependencies
#         run: |
#           python -m pip install --upgrade pip
#           if [ -f requirements.txt ]; then
#             pip install -r requirements.txt
#           else
#             echo "No requirements.txt, skip install deps"
#           fi

#       - name: Run tests
#         run: |
#           if [ -d tests ]; then
#             pytest
#           else
#             echo "No tests directory, skipping tests for now"
#           fi

#   # ================= CD =================
#   deploy:
#     name: Deploy Metaphysical Lambda
#     needs: test
#     if: github.event_name == 'push' && github.ref == 'refs/heads/main'
#     runs-on: ubuntu-latest
#     defaults:
#       run:
#         working-directory: lambda/metaphysical

#     steps:
#       - name: Checkout code
#         uses: actions/checkout@v4

#       - name: Set up Python (3.10)
#         uses: actions/setup-python@v5
#         with:
#           python-version: "3.10"

#       - name: Install dependencies into package folder
#         run: |
#           mkdir -p package
#           python -m pip install --upgrade pip
#           if [ -f requirements.txt ]; then
#             pip install -r requirements.txt -t package
#           fi
#           cp lambda_function.py package/

#       - name: Zip Lambda package
#         run: |
#           cd package
#           zip -r ../metaphysical.zip .

#       - name: Configure AWS Credentials
#         uses: aws-actions/configure-aws-credentials@v2
#         with:
#           aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
#           aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
#           aws-region: ap-southeast-1

#       - name: Deploy to Lambda
#         run: |
#           aws lambda update-function-code \
#             --function-name sorcererxstreme-metaphysical \
#             --zip-file fileb://metaphysical.zip